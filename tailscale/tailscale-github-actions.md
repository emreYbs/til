# Using a Tailscale exit node with GitHub Actions

For an (ethical) [scraping project](https://github.com/simonw/scrape-doge-gov) I found that my low-volume scraper was working from my laptop but was being blocked by Cloudflare when I attempted to run it in GitHub Actions, presumably because the GitHub Actions IP range was disallowed.

I figured out how to use [Tailscale](https://tailscale.com/) to allow GitHub Actions to transparently proxy traffic via my home network - using a Tailscale exit node running on an Apple TV.

## Setting up the Apple TV as an exit node

This took a few steps:

1. [Install the Tailscale app](https://tailscale.com/kb/1280/appletv) (from the App Store) on the Apple TV
2. Configure the Apple TV as a "home hub". To do this I had to reconfigure my Apple TV to have a default iCloud account - we had previously configured it with no default account and two different associated accounts. I got various unhelplful error messages until I finally figured this out. The [Apple documentation](https://support.apple.com/en-us/102557) wasn't quite helpful enough here either.
3. Configure the Apple TV to work as a Tailscale exit node. [Here's the Tailscale guide](https://tailscale.com/kb/1280/appletv#advertise-apple-tv-as-an-exit-node) to doing this - you configure it in the Apple TV app ("Run as Exit Node") and _then_ separately in the Tailscale web console. The hardest part here was finding the option there - it was tucked away in the "..." menu against the Apple TV machine under "Edit route settings".

The great thing about an Apple TV for this is that it's an existing low power device that is always on and connected to the internet. A Raspberry Pi or similar would be another good choice.

## Create a Tailscale OAuth client

The GitHub Actions workflow needs an OAuth client with credentials that allow it to join the Tailscale network.

This can be created at [https://login.tailscale.com/admin/settings/oauth](https://login.tailscale.com/admin/settings/oauth)

As far as I can tell this needs the "Devices: Core" scopes configured for both read and write access, plus a tag. It also needed read/write access for **Auth Keys**.

Here's how I configured that device access:

![Screenshot of OAuth device permissions interface showing "Devices" section with "Core" permissions that include "Read" and "Write" checkboxes (both checked). Text reads "Read or modify devices and their properties." Below is a "Tags" section labeled "(required for write scope)" with explanation "Access tokens generated by this OAuth Client will be able to assign the below tags to devices." There is one tag shown: "tag:github-actions". Below is an "Add tags" dropdown.](https://static.simonwillison.net/static/2025/tailscale-oauth.jpg)

Plus I selected the read and write checkboxes for "Auth Keys".

I also added the tag to another section in the Tailscale interface, because one of the documents I read suggested that the tag needed that. I don't know if this is necessary or not, but I used the JSON editing interface at [https://login.tailscale.com/admin/acls/file](https://login.tailscale.com/admin/acls/file) and added this:

```
...
	"tagOwners": {
		"tag:github-actions": ["autogroup:admin"],
	}
...
```
(I'm hoping a Tailscale expert can confirm if this was necessary or not!)

## Configuring GitHub Actions to use the exit node

This took [a lot of experimenting](https://github.com/simonw/playing-with-actions-single/commits/main/.github/workflows/tailscale-exit-node.yml), but eventually I figured out this recipe which works. I had to set three repository secrets first:

- `TAILSCALE_OAUTH_CLIENT_ID` - for the OAuth client I created earlier
- `TAILSCALE_OAUTH_SECRET` - also for that client
- `TAILSCALE_EXIT_NODE` - I was hoping I could set this to the name of my Apple TV within Tailscale, but that didn't seem to work - here's [a relevant Tailscale issue thread](https://github.com/tailscale/tailscale/issues/4152). Setting it to the Tailscale IP address of that device - which starts `100.106....` - worked for me.

Here's the YAML:

```yaml
name: Tailscale exit node demo

on:
  workflow_dispatch:

jobs:
  run-with-tailscale:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show IP before Tailscale
        run: |
          echo "IP from ifconfig.me:"
          curl -s https://ifconfig.me

      - name: Setup Tailscale
        uses: tailscale/github-action@v3
        with:
          oauth-client-id: ${{ secrets.TAILSCALE_OAUTH_CLIENT_ID }}
          oauth-secret: ${{ secrets.TAILSCALE_OAUTH_SECRET }}
          args: "--exit-node=${{ secrets.TAILSCALE_EXIT_NODE }} --exit-node-allow-lan-access=true"
          tags: tag:github-actions
      
      - name: Verify HTTP traffic is routed through exit node
        run: |
          echo "Available exit nodes:"
          tailscale status | grep 'exit node'

          echo "IP from ifconfig.me:"
          curl -s https://ifconfig.me
```
Since this sets `workflows_dispatch` as the trigger, I can run this by clicking the "Run workflow" button in the GitHub Actions UI.

When I [ran the workflow](https://github.com/simonw/playing-with-actions-single/blob/main/.github/workflows/tailscale-exit-node.yml) I saw this, confirming that it works:

> **Show IP before Tailscale**
> ```
> Run echo "IP from ifconfig.me:"
> IP from ifconfig.me:
> 20.57.71.203
> ```
> **Setup Tailscale** - took nearly 2 minutes!
> ```
> ...
>   shell: /usr/bin/bash --noprofile --norc -e -o pipefail {0}
>   env:
>     ADDITIONAL_ARGS: --exit-node=*** --exit-node-allow-lan-access=true
>     HOSTNAME: 
>     TAILSCALE_AUTHKEY: 
>     TIMEOUT: 2m
>     TS_EXPERIMENT_OAUTH_AUTHKEY: true
> ```
> **Verify HTTP traffic is routed through exit node**
> ```
> Run echo "Available exit nodes:"
> Available exit nodes:
> ***  apple-tv             user@   tvOS    active; exit node; relay "sfo", tx 148 rx 0
> IP from ifconfig.me:
> 67.... # my home IP address
